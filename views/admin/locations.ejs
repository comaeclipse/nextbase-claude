<div class="locations-management">
    <div class="management-header">
        <div class="header-info">
            <h2>Location Management</h2>
            <p>Manage retirement locations and their data</p>
        </div>
        <div class="header-actions">
            <a href="/admin/locations/add" class="btn btn-primary">
                <i class="fas fa-plus"></i>
                <span>Add Location</span>
            </a>
            <div class="file-upload">
                <input type="file" id="csvImport" name="csvFile" accept=".csv">
                <label for="csvImport" class="file-upload-label">
                    <i class="fas fa-upload"></i>
                    <span>Import CSV</span>
                </label>
            </div>
        </div>
    </div>

    <div class="stats-bar">
        <div class="stat-item">
            <span class="stat-value"><%= stats.total_locations %></span>
            <span class="stat-label">Total Locations</span>
        </div>
        <div class="stat-item">
            <span class="stat-value"><%= stats.states_count %></span>
            <span class="stat-label">States</span>
        </div>
        <div class="stat-item">
            <span class="stat-value"><%= stats.avg_cost_of_living || 'N/A' %></span>
            <span class="stat-label">Avg Cost Index</span>
        </div>
        <div class="stat-item">
            <span class="stat-value"><%= stats.avg_healthcare_score || 'N/A' %></span>
            <span class="stat-label">Avg Healthcare</span>
        </div>
    </div>

    <div class="table-container">
        <% if (locations && locations.length > 0) { %>
            <table class="data-table">
                <thead>
                    <tr>
                        <th data-sortable>Name</th>
                        <th data-sortable>State</th>
                        <th data-sortable>Region</th>
                        <th data-sortable>Climate</th>
                        <th data-sortable>Cost of Living</th>
                        <th data-sortable>Healthcare Score</th>
                        <th data-sortable>Veteran %</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% locations.forEach(location => { %>
                        <tr>
                            <td>
                                <div class="location-name">
                                    <strong><%= location.name %></strong>
                                    <small><%= location.city %></small>
                                </div>
                            </td>
                            <td><%= location.state %></td>
                            <td>
                                <span class="region-badge region-<%= location.region %>">
                                    <%= location.region %>
                                </span>
                            </td>
                            <td>
                                <% if (location.climate_type) { %>
                                    <span class="climate-badge climate-<%= location.climate_type %>">
                                        <%= location.climate_type %>
                                    </span>
                                <% } else { %>
                                    <span class="text-muted">N/A</span>
                                <% } %>
                            </td>
                            <td>
                                <% if (location.cost_of_living_index) { %>
                                    <%= location.cost_of_living_index %>
                                <% } else { %>
                                    <span class="text-muted">N/A</span>
                                <% } %>
                            </td>
                            <td>
                                <% if (location.healthcare_quality_score) { %>
                                    <div class="score-bar">
                                        <div class="score-fill" style="width: <%= location.healthcare_quality_score %>%"></div>
                                        <span class="score-text"><%= location.healthcare_quality_score %></span>
                                    </div>
                                <% } else { %>
                                    <span class="text-muted">N/A</span>
                                <% } %>
                            </td>
                            <td>
                                <% if (location.veteran_population_pct) { %>
                                    <%= location.veteran_population_pct %>%
                                <% } else { %>
                                    <span class="text-muted">N/A</span>
                                <% } %>
                            </td>
                            <td>
                                <div class="actions">
                                    <a href="/admin/locations/edit/<%= location.id %>" class="btn-small btn-edit" data-tooltip="Edit Location">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <button class="btn-small btn-delete" data-type="location" data-id="<%= location.id %>" data-name="<%= location.name %>" data-tooltip="Delete Location">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>

            <% if (totalPages > 1) { %>
                <div class="pagination">
                    <% if (currentPage > 1) { %>
                        <a href="/admin/locations?page=<%= currentPage - 1 %>">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                    <% } %>

                    <% for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) { %>
                        <% if (i === currentPage) { %>
                            <span class="current"><%= i %></span>
                        <% } else { %>
                            <a href="/admin/locations?page=<%= i %>"><%= i %></a>
                        <% } %>
                    <% } %>

                    <% if (currentPage < totalPages) { %>
                        <a href="/admin/locations?page=<%= currentPage + 1 %>">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    <% } %>
                </div>
            <% } %>
        <% } else { %>
            <div class="empty-state">
                <i class="fas fa-map-marked-alt"></i>
                <h3>No Locations Found</h3>
                <p>Get started by adding your first location or importing data from a CSV file.</p>
                <div class="empty-actions">
                    <a href="/admin/locations/add" class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                        <span>Add First Location</span>
                    </a>
                </div>
            </div>
        <% } %>
    </div>
</div>

<!-- CSV Import Form (hidden) -->
<form id="csvImportForm" action="/admin/import/csv" method="POST" enctype="multipart/form-data" style="display: none;">
    <input type="file" name="csvFile" accept=".csv">
</form>

